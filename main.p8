pico-8 cartridge // http://www.pico-8.com
version 29
__lua__

world = {}
grass = {}
tiles = {}
items = {}

probs = {}

level = 1


c = {x=4, y=3}

-- grass

add(grass, {
	t="tile",
	name="grass2",
	p=2,
	value=0,
	s=6
})

add(grass, {
	t="tile",
	name="grass1",
	p=2,
	value=0,
	s=4
})

-- special item

key = {
	t="treasure",
	name="key",
	p=1,
	value=1,
	s=36
}

-- random spawn tiles

add(tiles, {
	t="tile",
	name="rock1",
	p=1,
	value=0,
	s=2
})

add(tiles, {
	t="tile",
	name="rock2",
	p=1,
	value=0,
	s=2
})

-- treasuer

add(tiles, {
	t="treasure",
	name="gold",
	p=3,
	value=1,
	s=32
})

add(tiles, {
	t="treasure",
	name="skull",
	p=1,
	damage=3,
	s=64
})

add(tiles, {
	t="treasure",
	name="chest",
	p=1,
	value=3,
	s=38
})

-- traps

add(tiles, {
	t="trap",
	name="snake",
	p=1,
	damage=1,
	s=66
})

add(tiles, {
	t="trap",
	name="spikes",
	p=1,
	damage=2,
	s=68
})

-- items

add(items, {
	t="item",
	name="pickaxe",
	p=2,
	uses=2,
	area=1,
	s=100
})

add(items, {
	t="item",
	name="vision",
	p=2,
	uses=3,
	area=0,
	s=96
})

add(items, {
	t="item",
	name="dynamite",
	p=1,
	uses=1,
	area=2,
	s=98
})


function _init()
	-- music(0)

	-- tile spawn probability
	for k,tile in pairs(tiles) do
		for i=1,tile.p do
			-- print(tile.name)
			add(probs, tile)
		end
	end

	-- print(#probs)
	for x=1,8 do
		add(world, {})
		for y=1,8 do
			-- 75% chance to spawn an item
			if (rnd(1) < 0.60) then
				add(world[x], { t=probs[flr(rnd(#probs))+1] })
			-- else just grass
			else
					add(world[x], { t=grass[flr(rnd(#grass))+1] })
			end
		end
 end

end


function _update()
	-- left
	if (btn(0)) then
		c.x = c.x-1
	end
	-- right
	if (btn(1)) then
		c.x = c.x+1
	end
	-- up
	if (btn(2)) then
		c.y = c.y-1
	end
	-- down
	if (btn(3)) then
		c.y = c.y+1
	end

	if c.x<1 then c.x=1 end
	if c.x>8 then c.x=8 end
	if c.y<1 then c.y=1 end
	if c.y>8 then c.y=8 end

	-- z
	if (btn(4)) then
		sfx(3)
	end
	-- x
	if (btn(5)) then
		sfx(0)
	end
end


function _draw()
	cls()
 for x=1,8 do
		for y=1,7 do
			s=world[x][y].t.s

			tx=x-1
			ty=y-1

			sx=(s%32)*8
			sy=flr(s/32)*16

			sspr(sx,sy,16,16,
				tx*16,ty*16)

		end
 end

	cx = c.x-1
	cy = c.y-1
	rect(cx*16,cy*16,cx*16+15,cy*16+15,15)
end

__gfx__
333333333333b3333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333330000000000000000
3333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333a330000000000000000
33354733333333333333bb33333333333333b33333a333333b3333333333333333333333333333333333b33333333333337a33b3333397a30000000000000000
333549773333333333333333576633b333333333bbbb3333333333333333333333b3333333333a33333333333333b33335973333a33399730000000000000000
3335444433333333333333335676633333333333b33b333333333333333333333333333333333333333333333333333335993597aaa355330000000000000000
333555533334773335763333555763333333333333333333333333333333b3333333333333333333333333333333333333553599aaaa33330000000000000000
3333333333549733357633330055533333333333333333333333333b3333333333333333333333333333333333333333333333597aaa33330000000000000000
333b33333354443335766333333333333333b3333333333b3333333333333333333333333333333333544443333333333333335997aa33330000000000000000
33333333335555333357663333333333333b333333333333333333333333333333333333b3333333335449943333333333333359997933330000000000000000
33333333333333333335766333333333333333333b33333333333333333333333333333333333333335544943333333333333335999533330000000000000000
333333333333333333566766633b33333333333333333333333333333b333333333333333333333333354443333333333335aaa3555333330000000000000000
354733b3333333b3335556766333766333333a33333333333333333333333333333333333333333333335533333333333597aaa3333333330000000000000000
35943333333333333300556763335763333bbb3333333333333333333333333333b3333333333333333333333333333335997aa3333333330000000000000000
3555333333567333333005553333057333333bb333333b333333333333333333333333333333a3333333333333333333359997a33333b3330000000000000000
333333333356a33333333333333333333333333333333333333b3333333333333333333333333333333333333b33333333599933b33333330000000000000000
33333333335553333333333333333333333333333333333333333333333333b33333333333333333333333333333333333355533333333330000000000000000
33333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000000000000000000000000000
33355355455555333555355455555533333555333555553333555533555555330000000000000000000000000000000000000000000000000000000000000000
33455555455554533455335455555453334455535555545335455553554554530000000000000000000000000000000000000000000000000000000000000000
3554555545554553354011c7777a4553355445533555445335544555355545530000000000000000000000000000000000000000000000000000000000000000
355545097754555335011ccccccaa553335545553545555335555111315455530000000000000000000000000000000000000000000000000000000000000000
3355509aa7755553301111cccaa7ca53333554455545545335501222221555530000000000000000000000000000000000000000000000000000000000000000
355509aa7a7755533011c1111177c753355455545555555333012222422153330000000000000000000000000000000000000000000000000000000000000000
344409a7a7a744533331c1cccc7cc7333555a7555aa7553333122222222215530000000000000000000000000000000000000000000000000000000000000000
3555097a7a77555333111c1ccc7cc333355aaaaaaa0a4433333311a1a11114430000000000000000000000000000000000000000000000000000000000000000
355509a7a7a75553350111c1cacc75533500a0a00aaa5333301122aaa22115530000000000000000000000000000000000000000000000000000000000000000
3335509a7a7555533550111cacc75553353050550005555330112222222115530000000000000000000000000000000000000000000000000000000000000000
3355450999545533355501111c745553333554454554555330112422222115530000000000000000000000000000000000000000000000000000000000000000
35545540005545533554501117554553355545554555455335011111115145330000000000000000000000000000000000000000000000000000000000000000
35455545555554533545530174555453334455354555545335400030000045330000000000000000000000000000000000000000000000000000000000000000
33553555533555333333355554555533333555354555553333555333555553330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000000000000000000000000000
33555533555555333335555535553533335553335555533333554553355555430000000000000000000000000000000000000000000000000000000000000000
35455000777554533345555545533533355557535745675333455455565554530000000000000000000000000000000000000000000000000000000000000000
35540099777745533554555333755453354456665656655335445555676555530000000000000000000000000000000000000000000000000000000000000000
355009aa7aaa753335545553bbb74553357655565605575335555655085565530000000000000000000000000000000000000000000000000000000000000000
35509aaaaaaaa75335554453bbbb5553355660550605663335356e855056e6530000000000000000000000000000000000000000000000000000000000000000
34009aa977977a533554553bbbbb7553354756055055653333550855655085330000000000000000000000000000000000000000000000000000000000000000
35099aa928928a533335553b8bb87553355655006607555334555058e65503530000000000000000000000000000000000000000000000000000000000000000
350099a988988a533535b03bbbbb7533335666500666545335565550655555530000000000000000000000000000000000000000000000000000000000000000
3330099aaaaaa453355b0b03bbbb5553355555566705665335876555055556530000000000000000000000000000000000000000000000000000000000000000
33550009aaaaa55335bb5b033337555335545075067555533508555556556e630000000000000000000000000000000000000000000000000000000000000000
35554500aaaaa5533b005b20080555533564565056505653355056556e6508530000000000000000000000000000000000000000000000000000000000000000
355455500a0a04533b05bb2228554553376566565575457335546e65065450530000000000000000000000000000000000000000000000000000000000000000
354545550909054330bbb22208555453355575533555545335450855505545530000000000000000000000000000000000000000000000000000000000000000
3355555535553333333b222055355533335553333335553333555055533554330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
33555545555555333355533355455533335533355555553300000000000000000000000000000000000000000000000000000000000000000000000000000000
33455554555554533545553555555453354555355555545300000000000000000000000000000000000000000000000000000000000000000000000000000000
35545555555545533554555355554053355456667555455300000000000000000000000000000000000000000000000000000000000000000000000000000000
35554eeeeee4555335554545552805533555455066a7555300000000000000000000000000000000000000000000000000000000000000000000000000000000
3555efffffffe5533355545558288553355555550666755300000000000000000000000000000000000000000000000000000000000000000000000000000000
333effccccfffe533335555588820553355455555066a55300000000000000000000000000000000000000000000000000000000000000000000000000000000
30effc0007cff333355555588820555335555555c006675300000000000000000000000000000000000000000000000000000000000000000000000000000000
30effc0000cffe3334455588820555433335555c1050673300000000000000000000000000000000000000000000000000000000000000000000000000000000
350efcc00cffe0533555588820555453335455c105506a3300000000000000000000000000000000000000000000000000000000000000000000000000000000
3540effccffe0553355528820555555335555c105555065300000000000000000000000000000000000000000000000000000000000000000000000000000000
35550effffe0555335550220555455533555c1054555655300000000000000000000000000000000000000000000000000000000000000000000000000000000
35554030000445533554500555554553355c10555455655300000000000000000000000000000000000000000000000000000000000000000000000000000000
35445533545545533545555355555433354005554555545300000000000000000000000000000000000000000000000000000000000000000000000000000000
33555553555554333355553355555333335555554555553300000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
001400200d0200e5200a7200e520003200e5200032009520115200f5200d5200852008520145200d720003201472019720197200132000320055200a3200b520145201752014720157201e7200a0201402000020
000a002003100274103341002310061001641003300033000510000700294103141003310007000d410023000910000700033002a410304100331003300144100610001700033002b4102e41002310033000b410
001e00200e71010710127100001017510000101f5100001019510000101a71017710127100001022510000101f510000101a7101c7101f710227100001020510000101f510000102051014710117101371019710
0002000003550025500865004650065500665007650096500b550096500a5500d6500d5500e6500c6500000000000000000000000000010000100001000010000100001000000000000000000000000000000000
__music__
00 02404242
00 02404344
00 00414344
00 01424344
00 01004344

