pico-8 cartridge // http://www.pico-8.com
version 29
__lua__

world = {}
grass = {}
tiles = {}
items = {}

probs = {}

level = 1


c = {x=4, y=3}

-- grass

add(grass, {
	t="tile",
	name="grass2",
	p=2,
	value=0,
	s=6
})

add(grass, {
	t="tile",
	name="grass1",
	p=2,
	value=0,
	s=4
})

-- special item

key = {
	t="treasure",
	name="key",
	p=1,
	value=1,
	s=36
}

-- random spawn tiles

add(tiles, {
	t="tile",
	name="rock1",
	p=1,
	value=0,
	s=2
})

add(tiles, {
	t="tile",
	name="rock2",
	p=1,
	value=0,
	s=2
})

-- treasuer

add(tiles, {
	t="treasure",
	name="gold",
	p=3,
	value=1,
	s=32
})

add(tiles, {
	t="treasure",
	name="skull",
	p=1,
	damage=3,
	s=64
})

add(tiles, {
	t="treasure",
	name="chest",
	p=1,
	value=3,
	s=38
})

-- traps

add(tiles, {
	t="trap",
	name="snake",
	p=1,
	damage=1,
	s=66
})

add(tiles, {
	t="trap",
	name="spikes",
	p=1,
	damage=2,
	s=68
})

-- items

add(items, {
	t="item",
	name="pickaxe",
	p=2,
	uses=2,
	area=1,
	s=100
})

add(items, {
	t="item",
	name="vision",
	p=2,
	uses=3,
	area=0,
	s=96
})

add(items, {
	t="item",
	name="dynamite",
	p=1,
	uses=1,
	area=2,
	s=98
})


function _init()
	-- music(0)

	-- tile spawn probability
	for k,tile in pairs(tiles) do
		for i=1,tile.p do
			-- print(tile.name)
			add(probs, tile)
		end
	end

	-- print(#probs)
	for x=1,8 do
		add(world, {})
		for y=1,8 do
			-- 75% chance to spawn an item
			if (rnd(1) < 0.60) then
				add(world[x], { t=probs[flr(rnd(#probs))+1] })
			-- else just grass
			else
					add(world[x], { t=grass[flr(rnd(#grass))+1] })
			end
		end
 end

end


function _update()
	-- left
	if (btn(0)) then
		c.x = c.x-1
	end
	-- right
	if (btn(1)) then
		c.x = c.x+1
	end
	-- up
	if (btn(2)) then
		c.y = c.y-1
	end
	-- down
	if (btn(3)) then
		c.y = c.y+1
	end

	if c.x<1 then c.x=1 end
	if c.x>8 then c.x=8 end
	if c.y<1 then c.y=1 end
	if c.y>8 then c.y=8 end

	-- z
	if (btn(4)) then
		sfx(3)
	end
	-- x
	if (btn(5)) then
		sfx(0)
	end
end


function _draw()
	cls()
 for x=1,8 do
		for y=1,7 do
			s=world[x][y].t.s

			tx=x-1
			ty=y-1

			sx=(s%32)*8
			sy=flr(s/32)*16

			sspr(sx,sy,16,16,
				tx*16,ty*16)

		end
 end

	cx = c.x-1
	cy = c.y-1
	rect(cx*16,cy*16,cx*16+15,cy*16+15,15)
end

__gfx__
33333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333330000000000000000
33333333333333333333335555553333333333333333333333333333333333333333333333333333333333333333333333335666366663330000000000000000
333547333333333333553566666553333333b33333a333333b3333333333333333333333333333333333b3333333333333356556665666330000000000000000
3335497733333333335055666666533333333333bbbb3333333333333333333333b3333333333a33333333333333b33333565556655666630000000000000000
3335444433333333335557666566533333333333b33b333333333333333333333333333333333333333333333333333335665556666677630000000000000000
333555533334773335005576666665333333333333333333333333333333b3333333333333333333333333333333333335655565666776630000000000000000
3333333333549733355005576656653333333333333333333333333b333333333333333333333333333333333333333335655655667767330000000000000000
333333333354443330500057766665533333b3333333333b33333333333333333333333333333333335444433333333335655656676677630000000000000000
33333333335555333550005776666653333b333333333333333333333333333333333333b3333333335449943333333335666566776776630000000000000000
33333333333333333335005577666653333333333b33333333333333333333333333333333333333335544943333333335665567766766730000000000000000
333333333333333333550005776666533333333333333333333333333b3333333333333333333333333544433333333335565667667667630000000000000000
3547333333333333335500005766653333333a333333333333333333333333333333333333333333333355333333333335656676676677630000000000000000
35943333333333333330500005765333333bbb3333333333333333333333333333b3333333333333333333333333333333556676776776330000000000000000
3555333333567333333555000055533333333bb333333b333333333333333333333333333333a333333333333333333333356666766763330000000000000000
333333333356a33333335555550533333333333333333333333b3333333333333333333333333333333333333333333333335555555533330000000000000000
33333333335553333333333333333333333333333333333333333333333333b33333333333333333333333333333333333333333333333330000000000000000
33333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000000000000000000000000000
33355355555555333555355555555533333555333555553333555533555555330000000000000000000000000000000000000000000000000000000000000000
33444445445444533444334544444553335444534444555334444453444444530000000000000000000000000000000000000000000000000000000000000000
3445444555544553344011c7777a4453345544433445545334544444344455530000000000000000000000000000000000000000000000000000000000000000
344455097754555335011ccccccaa453334554443445445334555111314554530000000000000000000000000000000000000000000000000000000000000000
3344509aa7754453301111cccaa7ca53333455444455445334401222221544530000000000000000000000000000000000000000000000000000000000000000
344409aa7a7754533011c1111177c753344445555555445333012222422143330000000000000000000000000000000000000000000000000000000000000000
345509a7a7a755533331c1cccc7cc7333444a7555aa7553333122222222214530000000000000000000000000000000000000000000000000000000000000000
3445097a7a77445333111c1ccc7cc333345aaaaaaa0a4433333311a1a11114530000000000000000000000000000000000000000000000000000000000000000
344409a7a7a75453340111c1cacc74533400a0a00aaa4333301122aaa22114530000000000000000000000000000000000000000000000000000000000000000
3334409a7a7555533440111cacc75453343050550004445330112222222114530000000000000000000000000000000000000000000000000000000000000000
3344450999554433344501111c745553333455445445545330112422222114530000000000000000000000000000000000000000000000000000000000000000
34445540004444533555401117544453344454445444555335011111115144330000000000000000000000000000000000000000000000000000000000000000
34454444444444533444430174554553334554355444455334500030000045330000000000000000000000000000000000000000000000000000000000000000
33453444433445333333344444455533333555355555553333444333555553330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
33555533555555333335555535553533334443334444433300000000000000000000000000000000000000000000000000000000000000000000000000000000
34554000677455533345544444433533344447434744674300000000000000000000000000000000000000000000000000000000000000000000000000000000
34450055666754533444554333744553344446664646644300000000000000000000000000000000000000000000000000000000000000000000000000000000
344005666666743334444553bbb75553347644564605474300000000000000000000000000000000000000000000000000000000000000000000000000000000
355056666666675334444453bbbb4453344660550605663300000000000000000000000000000000000000000000000000000000000000000000000000000000
34005666776776533455543bbbbb7453344756055055643300000000000000000000000000000000000000000000000000000000000000000000000000000000
340556658a6a86533334543b8bb87453344655006607544300000000000000000000000000000000000000000000000000000000000000000000000000000000
34005566886886533434b03bbbbb7433334666500666554300000000000000000000000000000000000000000000000000000000000000000000000000000000
3330055666666453344b0b03bbbb4453344455566705664300000000000000000000000000000000000000000000000000000000000000000000000000000000
334500056666645334bb4b0333374453344550750675544300000000000000000000000000000000000000000000000000000000000000000000000000000000
34444500666664533b004b2008054453346446505640564300000000000000000000000000000000000000000000000000000000000000000000000000000000
34455440060604533b04bb2228455453376466564474447300000000000000000000000000000000000000000000000000000000000000000000000000000000
345544440606045330bbb22208445453344474433444444300000000000000000000000000000000000000000000000000000000000000000000000000000000
3344444434443333333b222044344433334443333334443300000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
33555555555555333355533355555533334433344444453300000000000000000000000000000000000000000000000000000000000000000000000000000000
33444444444455533445543445444453344444344444454300000000000000000000000000000000000000000000000000000000000000000000000000000000
34544555555454533444554345444053344446667444554300000000000000000000000000000000000000000000000000000000000000000000000000000000
34455eeeeee5445334444544442804533454444566a7444300000000000000000000000000000000000000000000000000000000000000000000000000000000
3445efffffffe5533344455558288453344454445666744300000000000000000000000000000000000000000000000000000000000000000000000000000000
333effccccfffe533335555588820453344455544566a44300000000000000000000000000000000000000000000000000000000000000000000000000000000
30effc0007cff3333444455888205553344444445056674300000000000000000000000000000000000000000000000000000000000000000000000000000000
30effc0000cffe333445558882044453333444455045673300000000000000000000000000000000000000000000000000000000000000000000000000000000
340efcc00cffe05335554888205544533344445504456a3300000000000000000000000000000000000000000000000000000000000000000000000000000000
3550effccffe04533444288205555553344445504444564300000000000000000000000000000000000000000000000000000000000000000000000000000000
34440effffe054533444022055444453344455044444644300000000000000000000000000000000000000000000000000000000000000000000000000000000
34455030000454533444500455544453344550444554644300000000000000000000000000000000000000000000000000000000000000000000000000000000
34544433454455533455544344554533344004454554444300000000000000000000000000000000000000000000000000000000000000000000000000000000
33544443445454333354443344455333334444444444443300000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
001400200d0200e5200a7200e520003200e5200032009520115200f5200d5200852008520145200d720003201472019720197200132000320055200a3200b520145201752014720157201e7200a0201402000020
000a002003100274103341002310061001641003300033000510000700294103141003310007000d410023000910000700033002a410304100331003300144100610001700033002b4102e41002310033000b410
001e00200e71010710127100001017510000101f5100001019510000101a71017710127100001022510000101f510000101a7101c7101f710227100001020510000101f510000102051014710117101371019710
0002000003550025500865004650065500665007650096500b550096500a5500d6500d5500e6500c6500000000000000000000000000010000100001000010000100001000000000000000000000000000000000
__music__
00 02404242
00 02404344
00 00414344
00 01424344
00 01004344

